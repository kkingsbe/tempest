# Tempest Coverage Configuration
# Cargo-tarpaulin configuration for coverage tracking
#
# Coverage Targets (from PRD):
#   - Overall: ≥85% line coverage
#   - tempest-decode (Decoder): ≥95% line coverage
#   - tempest-render-core (Rendering): ≥80% line coverage
#   - tempest-fetch (S3/network): ≥80% line coverage
#
# Coverage Ratchet Policy:
#   - Coverage must not decrease on any PR
#   - Threshold: 1.5% decrease allowed before CI fails

[tarpaulin]
# Output directory for coverage reports
output-dir = "./coverage"

# Generate HTML reports
html = true

# Generate XML reports (for CI integration)
xml = true

# Run tests in release mode (optional, remove for debug)
# release = true

# Follow links for tests in external crates
follow-tests = true

# Number of parallel jobs (default uses all cores)
# jobs = 4

# Timeout for each test (as a duration)
timeout = "5m"

# Skip failed tests and continue
skip-failed = false

# Exclude coverage for specific file patterns
exclude = [
    # Test files
    "**/tests/**",
    # Example binaries
    "**/examples/**",
    # Build artifacts
    "**/target/**",
    # Generated fixtures
    "**/fixtures/**",
    "**/generated/**",
    # Benchmark and doc tests
    "**/benches/**",
    "**/doc/**",
    # Archives
    "**/archive/**",
]

# Exclude specific packages from coverage
exclude-packages = [
    "tempest-app",  # CLI application, may have platform-specific code
]

# Include only specific packages (optional, leave empty for all)
# include = [
#     "tempest-decode",
#     "tempest-fetch",
#     "tempest-render-core",
# ]

# Set coverage thresholds
[tarpaulin.thresholds]
# Overall workspace coverage target (from PRD)
lines = 85
functions = 85
branches = 80

# Package-specific coverage targets (from PRD)
# Decoder module: ≥95% line coverage
[tarpaulin.thresholds.tempest-decode]
lines = 95
functions = 95
branches = 90

# Rendering module: ≥80% line coverage
[tarpaulin.thresholds.tempest-render-core]
lines = 80
functions = 80
branches = 75

# S3/network module: ≥80% line coverage
[tarpaulin.thresholds.tempest-fetch]
lines = 80
functions = 80
branches = 75

[workspace]
# Enable workspace-wide coverage tracking
workspace-annotation = true

# Include all workspace members
all = true
